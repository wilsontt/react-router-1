# 結帳與「填寫訂單資料」區塊切換實作說明

## 1. 目的

本文件記錄以 **React state** 控制「填寫訂單資料」區塊的顯示／隱藏、按鈕文字在「結帳」與「取消結帳」間切換、收合時清空表單的實作方式，供維護與擴充時參考。

## 2. 範圍

- **頁面**：`pages/Cart.jsx`（購物車列表頁）
- **區塊**：結帳按鈕與「填寫訂單資料」表單區（收件人資料、付款方式、付款金額、取消訂單／確認訂單按鈕）
- **行為**：按「結帳」→ 顯示「填寫訂單資料」、按鈕變「取消結帳」；再按「取消結帳」→ 隱藏區塊、清空表單、按鈕變「結帳」

## 3. 權責

| 模組 | 檔案 | 職責 |
|------|------|------|
| 購物車與訂單表單 | `pages/Cart.jsx` | 結帳按鈕、填寫訂單區塊顯示／隱藏、表單清空、react-hook-form 註冊與 reset |

## 4. 名詞解釋

| 名詞 | 說明 |
|------|------|
| isOrderFormExpanded | React state（boolean）：true = 顯示「填寫訂單資料」區塊、按鈕文字「取消結帳」；false = 隱藏區塊、按鈕文字「結帳」 |
| toggleOrderForm | 切換函式：展開時改為收合並清空表單；收合時改為展開 |
| reset | react-hook-form 的 reset()，將所有已註冊欄位還原為 defaultValues |

## 5. 作業內容（實作要點）

### 5.1 設計原則

- **不依賴 Bootstrap collapse 的 data-bs-toggle**：改由 React state 控制顯示／隱藏，以便在收合時呼叫 `reset()` 清空表單。
- **按鈕文字與 state 同步**：`isOrderFormExpanded ? "取消結帳" : "結帳"`。
- **收合時清空表單**：在 `toggleOrderForm` 內，當 `isOrderFormExpanded === true` 時先呼叫 `reset()` 再 `setIsOrderFormExpanded(false)`。

### 5.2 State 與 useForm

- **state**：`const [isOrderFormExpanded, setIsOrderFormExpanded] = useState(false);`
- **useForm**：使用 `reset`（取代僅重置單一欄位的 `resetField`），並設定 `defaultValues` 涵蓋所有表單欄位，以便 `reset()` 還原為預設值：
  - `name`、`email`、`phone`、`address`：空字串
  - `payment_method`：`"1"`（信用卡）

### 5.3 toggleOrderForm 邏輯

```javascript
const toggleOrderForm = () => {
  if (isOrderFormExpanded) {
    reset();                    // 清空表單（還原為 defaultValues）
    setIsOrderFormExpanded(false);
  } else {
    setIsOrderFormExpanded(true);
  }
};
```

### 5.4 按鈕與區塊結構

- **結帳／取消結帳按鈕**：
  - 移除 `data-bs-toggle="collapse"`、`data-bs-target="#order-form"`。
  - `onClick={toggleOrderForm}`。
  - 文字：`{isOrderFormExpanded ? "取消結帳" : "結帳"}`。
  - `aria-expanded={isOrderFormExpanded}`、`aria-controls="order-form"`（無障礙）。

- **「填寫訂單資料」區塊**：
  - `className`：`container collapse${isOrderFormExpanded ? " show" : ""}`，依 state 加上 Bootstrap 的 `show` 類別以顯示區塊。
  - `id="order-form"`（對應 `aria-controls`）。

### 5.5 表單欄位註冊

- 收件人姓名、EMAIL、手機、地址、**付款方式**（`payment_method`）皆需以 `register()` 註冊，`reset()` 才會一併還原；付款方式 `<select>` 需加上 `{...register("payment_method")}` 並在 `defaultValues` 中設定 `payment_method: "1"`。

## 6. 參考文件

- [Bootstrap 5 Collapse](https://getbootstrap.com/docs/5.3/components/collapse/)（僅使用 `.collapse`、`.show` 樣式）
- [react-hook-form reset](https://react-hook-form.com/docs/useform/reset)
- 專案內：`1.docs/購物流程與API說明.md`（購物車與結帳流程）
- 專案內：`pages/Cart.jsx`（實際實作）

## 7. 驗證方式

| 項目 | 預期結果 |
|------|----------|
| 點「結帳」 | 顯示「填寫訂單資料」區塊，按鈕文字變為「取消結帳」 |
| 填寫部分欄位後點「取消結帳」 | 區塊隱藏、按鈕文字變為「結帳」；再次點「結帳」時，表單為空（含付款方式為「信用卡」） |
| 表單送出（確認訂單） | 行為與既有流程一致（`onOrderSubmit` 仍會觸發） |
